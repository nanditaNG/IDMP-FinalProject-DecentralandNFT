---
title: "NFT Decentraland Trends Predictions and Analysis"
authors: "Nandita Gurwara, Shweta Mishra, Shailesh Chikne, Rishabh Chhaparia"
date: "04/01/2022"
output:
  pdf_document: default
  html_document: default
---
```{r}
remove.packages("rlang")
```
```{r}
install.packages("rlang")
```



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
options(warn = -1)
library(rlang)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(modelr)
library(stringr)
library(ggpubr)
```


```{r warning=FALSE}
# Read the data from CSV files

nftdf <- read_csv("./NFT_Decentraland.csv", col_types = cols())

nftdf <- nftdf %>%
  mutate(
    createdAt = as.POSIXct(createdAt, origin = "1970-01-01"),
    updatedAt = as.POSIXct(updatedAt, origin = "1970-01-01"),
    expiresAt = as.POSIXct(expiresAt * 0.001, origin = "1970-01-01"),
    price = price / (10**18)
  )

df_split <- split(nftdf, nftdf$nftAddress)

for (i in 1:length(df_split)) {
  df_split[[i]] <- df_split[[i]] %>%
    mutate(sale_type = ifelse(createdAt == min(df_split[[i]]$createdAt),
      "Primary", "Secondary"
    ))
}

nftdf_updated <- bind_rows(df_split) %>%
  arrange(desc(createdAt))
```


```{r}
# Install package to read image
install.packages("imager")
library(stringr)
regexp <- "'image': '[^']*"
nftdf_updated$image <- str_match_all(nftdf_updated$nft, regexp) %>%
  str_replace_all("'image': '", "")

write.csv(nftdf_updated, "./NFT_Decentraland_Transformed.csv")

# method to load images
# load.image(nftdf_updated$image[1])
```



```{r}
#Top 5 NFTs per category as tables
#Install grid package before executing the code
#install.packages("gridExtra")
library(gridExtra)
library(grid)
nftDf <- read_csv("./NFT_Decentraland_Transformed.csv", col_types = cols())

top5 <- nftDf %>% 
  select(category, price,image) %>%
  group_by(category) %>%
  arrange(desc(price)) %>%
  top_n(5,price)

top5_id <- nftDf %>% 
  select(id,category, price,image) %>%
  group_by(category) %>%
  arrange(desc(price)) %>%
  top_n(5,price)

top5

data_estate <- filter(top5,category=='estate')
data_parcel <- filter(top5,category=='parcel')
data_ens <- filter(top5,category=='ens')
data_wearable <-filter(top5,category=='wearable')
```
```{r}
#setting theme for tables
tt3 <- ttheme_minimal(
  core=list(bg_params = list(fill = blues9[1:4], col=NA),
            fg_params=list(fontface=3)),
  colhead=list(fg_params=list(col="navyblue", fontface=4L)),
  rowhead=list(fg_params=list(col="blue", fontface=3L)))

pdf("Estate.pdf",width=10)
grid.table(as.data.frame(data_estate), theme =tt3)
dev.off()
```
```{r}
pdf("parcel.pdf",width=10)
grid.table(as.data.frame(data_parcel), theme =tt3)
dev.off()
```


```{r}
pdf("ens.pdf",width=10)
grid.table(as.data.frame(data_ens), theme =tt3)
dev.off()
```

```{r}
pdf("wearable.pdf",width=20)
grid.table(as.data.frame(data_wearable), theme =tt3)
dev.off()
```

## Shweta - Some more visualizations

## A

## NFT distribution among categories

```{r pressure, echo=FALSE}
library(ggplot2)
ggplot(nftDf,aes(x=category))+
  geom_histogram(stat="count",aes(fill=category),show.legend = FALSE)+
labs(title="Wearable has the highest amount of NFTs",
     x="Different Categories of NFT")+
theme_classic()
```

## B

# Price and SD across ctaegories

```{r pressure, echo=FALSE}
library(ggplot2)
ggplot(nftDf,aes(x=category))+
  geom_boxplot(aes(y=log10(price),
                     fill=category),
                 show.legend = FALSE)+
labs(title="Estate has the highest average price
but the spread is more in Wearable.",
     x="Categories of NFT",
     y="Price of NFTs")+
theme_classic()
```

## C

# PRICE TRENDS OF TOP 5 

# adding createdAt column for Visualization

```{r tello}
top5_id1 <- nftDf %>% 
  select(id,category, price,image,createdAt) %>%
  group_by(category) %>%
  arrange(desc(price)) %>%
  top_n(5,price)
```

#trying to visualize each category in different plots, hence segregating the data, also adding createdAt column

```{r test}
data_estate1 <- filter(top5_id1,category=='estate')
data_parcel1 <- filter(top5_id1,category=='parcel')
data_ens1 <- filter(top5_id1,category=='ens')
data_wearable1 <- filter(top5_id1,category=='wearable')
```

```{r pressure, echo=FALSE}
library(ggplot2)
fun_color_range <- colorRampPalette(c("yellow", "black","red")) 
my_colors <- fun_color_range(20)
ggplot(top5_id1,aes(x=createdAt))+
  geom_point(aes(y=price
             ,color=price),alpha=0.1,size=0.07)+
scale_colour_gradientn(colors = my_colors)+   
labs(title="Change of NFT Price (in Crypto) over the years",
     x="Years",
     y="Price (in Crypto Currency)")+
facet_grid(~category)+ 
geom_smooth(aes(x=createdAt,
                y=price),
            color="Red",
            size=0.5)+
theme(axis.text.x=element_text(angle = 90))
```

# ESTATE : top 5 price trend 

```{r pressure, echo=FALSE}
library(ggplot2)
fun_color_range <- colorRampPalette(c("yellow", "black","red")) 
my_colors <- fun_color_range(20)
ggplot(data_estate1,aes(x=createdAt))+
  geom_point(aes(y=price
             ,color=price),alpha=0.1,size=0.07)+
scale_colour_gradientn(colors = my_colors)+   
labs(title="Change of NFT Price (in Crypto) over the years",
     x="Years",
     y="Price (in Crypto Currency)")+
geom_smooth(aes(x=createdAt,
                y=price),
            color="Red",
            size=0.5)+
theme(axis.text.x=element_text(angle = 90))
```

# PARCEL : top 5 price trend 

```{r pressure, echo=FALSE}
library(ggplot2)
fun_color_range <- colorRampPalette(c("yellow", "black","red")) 
my_colors <- fun_color_range(20)
ggplot(data_parcel1,aes(x=createdAt))+
  geom_point(aes(y=price
             ,color=price),alpha=0.1,size=0.07)+
scale_colour_gradientn(colors = my_colors)+   
labs(title="Change of NFT Price (in Crypto) over the years",
     x="Years",
     y="Price (in Crypto Currency)")+
geom_smooth(aes(x=createdAt,
                y=price),
            color="Red",
            size=0.5)+
theme(axis.text.x=element_text(angle = 90))
```

# ENS : top 5 price trend 

```{r pressure, echo=FALSE}
library(ggplot2)
fun_color_range <- colorRampPalette(c("yellow", "black","red")) 
my_colors <- fun_color_range(20)
ggplot(data_ens1,aes(x=createdAt))+
  geom_point(aes(y=price
             ,color=price),alpha=0.1,size=0.07)+
scale_colour_gradientn(colors = my_colors)+   
labs(title="Change of NFT Price (in Crypto) over the years",
     x="Years",
     y="Price (in Crypto Currency)")+
geom_smooth(aes(x=createdAt,
                y=price),
            color="Red",
            size=0.5)+
theme(axis.text.x=element_text(angle = 90))
```

# WEARABLE : top 5 price trend 

```{r pressure, echo=FALSE}
library(ggplot2)
fun_color_range <- colorRampPalette(c("yellow", "black","red")) 
my_colors <- fun_color_range(20)
ggplot(data_wearable1,aes(x=createdAt))+
  geom_point(aes(y=price
             ,color=price),alpha=0.1,size=0.07)+
scale_colour_gradientn(colors = my_colors)+   
labs(title="Change of NFT Price (in Crypto) over the years",
     x="Years",
     y="Price (in Crypto Currency)")+
geom_smooth(aes(x=createdAt,
                y=price),
            color="Red",
            size=0.5)+
theme(axis.text.x=element_text(angle = 90))
```


### Add wearable category
```{r}

nftDf <- read_csv("./NFT_Decentraland_Transformed.csv", col_types = cols())
regexp <- "'searchWearableCategory': '[^']*"
nftDf$wearableCategory <- str_match_all(nftdf_updated$nft, regexp) %>%
  str_replace_all("'searchWearableCategory': '", "")
nftDf$wearableCategory[nftDf$wearableCategory == "character(0)"] = NA
write.csv(nftDf, "./NFT_Decentraland_Transformed.csv")

```